/**
 * @file        milestone.css
 * @description 里程碑模块 — 完整样式表
 *
 * @summary
 *   本文件是里程碑页面的唯一样式来源，独立于项目主站的
 *   css/extra.css 体系，确保不产生任何样式污染。
 *
 *   架构遵循项目 CSS 哲学：
 *   - 所有可调参数集中在 CSS 变量区
 *   - 按职责分为 变量 → 重置 → 布局 → 组件 → 动画 → 响应式
 *
 * @author      NCUSCC & Community Contributors
 * @version     2.0.0
 */


/* =============================================================
   0. CSS 变量 / Design Tokens
   —— 修改此处即可全局调色，无需深入各选择器
   ============================================================= */
:root {
  /* 字体 */
  --ms-font-display: 'Playfair Display', 'Noto Serif SC', serif;
  --ms-font-body:    'Noto Serif SC', 'Georgia', serif;
  --ms-font-mono:    'JetBrains Mono', monospace;

  /* 主色调（深色底色系） */
  --ms-bg-deep:      #1a1a2e;
  --ms-text-warm:    #f0e6d3;
  --ms-text-muted:   #8a8a9a;
  --ms-text-dim:     #6a6a7a;
  --ms-text-faint:   #5a5a6a;
  --ms-text-ghost:   #4a4a5a;

  /* 交互色 */
  --ms-border-subtle: rgba(240, 230, 211, 0.15);
  --ms-border-hover:  rgba(240, 230, 211, 0.4);
  --ms-surface-glass: rgba(26, 26, 46, 0.7);
  --ms-surface-hover: rgba(240, 230, 211, 0.15);

  /* 卡片 */
  --ms-card-radius:  12px;
  --ms-card-blur:    12px;

  /* 时间轴 */
  --ms-track-height: 4px;
}


/* =============================================================
   1. 全局重置
   ============================================================= */
*, *::before, *::after {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html, body {
  height: 100%;
  overflow: hidden;                /* 由 JS 控制横向滚动 */
  background: var(--ms-bg-deep);
  color: #333;
  font-family: var(--ms-font-body);
}


/* =============================================================
   2. 加载屏幕
   ============================================================= */
#loading-screen {
  position: fixed;
  inset: 0;
  z-index: 9999;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: var(--ms-bg-deep);
  transition: opacity 0.8s ease, visibility 0.8s ease;
}

#loading-screen.hidden {
  opacity: 0;
  visibility: hidden;
}

#loading-screen h1 {
  font-family: var(--ms-font-display);
  font-size: clamp(2rem, 5vw, 4rem);
  color: var(--ms-text-warm);
  letter-spacing: 0.15em;
  animation: fadeInUp 1s ease forwards;
}

#loading-screen p {
  margin-top: 1rem;
  color: var(--ms-text-muted);
  font-size: 0.95rem;
  letter-spacing: 0.3em;
  animation: fadeInUp 1s 0.3s ease forwards;
  opacity: 0;
}


/* =============================================================
   3. 主场景容器
   ============================================================= */
#app {
  position: relative;
  width: 100%;
  height: 100%;
  overflow: hidden;
  cursor: grab;
}

#app:active {
  cursor: grabbing;
}

/* 季节背景渐变层 */
#season-bg {
  position: absolute;
  inset: 0;
  z-index: 0;
  transition: background 0.6s ease;
}

/* 粒子画布（花瓣/萤火虫/落叶/雪花） */
#particles-canvas {
  position: absolute;
  inset: 0;
  z-index: 1;
  pointer-events: none;
}


/* =============================================================
   4. 水平时间轴轨道
   ============================================================= */
#timeline-viewport {
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 2;
  overflow: visible;
}

#timeline-track {
  position: absolute;
  bottom: 80px;
  height: var(--ms-track-height);
  background: rgba(255, 255, 255, 0.3);
  border-radius: 2px;
}

/* 时间刻度 */
.timeline-tick {
  position: absolute;
  bottom: 72px;
  transform: translateX(-50%);
  display: flex;
  flex-direction: column;
  align-items: center;
  z-index: 3;
}

.timeline-tick .tick-line {
  width: 2px;
  height: 16px;
  background: rgba(255, 255, 255, 0.4);
  border-radius: 1px;
}

.timeline-tick .tick-label {
  margin-top: 4px;
  font-size: 0.7rem;
  color: rgba(255, 255, 255, 0.6);
  white-space: nowrap;
  letter-spacing: 0.05em;
}


/* =============================================================
   5. 留言卡片
   ============================================================= */
.message-card {
  position: absolute;
  width: 220px;
  padding: 20px 18px;
  border-radius: var(--ms-card-radius);
  backdrop-filter: blur(var(--ms-card-blur));
  -webkit-backdrop-filter: blur(var(--ms-card-blur));
  border: 1px solid rgba(255, 255, 255, 0.25);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  cursor: default;
  animation: cardAppear 0.6s ease forwards;
  opacity: 0;
}

.message-card:hover {
  transform: translateY(-6px) scale(1.02);
  box-shadow: 0 16px 48px rgba(0, 0, 0, 0.15);
}

.message-card .card-content {
  font-size: 0.9rem;
  line-height: 1.7;
  word-break: break-word;
}

.message-card .card-meta {
  margin-top: 12px;
  padding-top: 10px;
  border-top: 1px solid rgba(0, 0, 0, 0.08);
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 0.72rem;
  opacity: 0.6;
}

.message-card .card-meta .fingerprint-icon {
  display: inline-flex;
  align-items: center;
  gap: 3px;
}

/* 卡片 → 时间轴的连接线 */
.card-connector {
  position: absolute;
  width: 1px;
  background: rgba(255, 255, 255, 0.3);
  z-index: 2;
}

.card-connector::after {
  content: '';
  position: absolute;
  bottom: -4px;
  left: -3px;
  width: 7px;
  height: 7px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.6);
}


/* =============================================================
   6. 方尖碑石基（底部装饰带）
   ============================================================= */
#obelisk-base {
  position: absolute;
  bottom: 0;
  left: 0;
  height: 70px;
  z-index: 3;
  background: linear-gradient(
    to top,
    rgba(30, 30, 50, 0.95) 0%,
    rgba(30, 30, 50, 0.7)  60%,
    transparent              100%
  );
}

/* 石纹装饰线 */
#obelisk-base::before {
  content: '';
  position: absolute;
  inset: 0;
  background: repeating-linear-gradient(
    90deg,
    transparent,
    transparent 80px,
    rgba(255, 255, 255, 0.03) 80px,
    rgba(255, 255, 255, 0.03) 81px
  );
}


/* =============================================================
   7. 顶部标题栏
   ============================================================= */
#top-bar {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 100;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 28px;
  background: linear-gradient(to bottom, rgba(26, 26, 46, 0.85), transparent);
  pointer-events: none;
}

#top-bar > * {
  pointer-events: auto;
}

#site-title {
  font-family: var(--ms-font-display);
  font-size: 1.4rem;
  color: var(--ms-text-warm);
  letter-spacing: 0.12em;
  text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}

#site-title span {
  font-family: var(--ms-font-body);
  font-size: 0.75rem;
  display: block;
  color: var(--ms-text-muted);
  letter-spacing: 0.3em;
  margin-top: 2px;
}

/* 季节指示器 */
#season-indicator {
  display: flex;
  align-items: center;
  gap: 8px;
  color: var(--ms-text-warm);
  font-size: 0.85rem;
  letter-spacing: 0.1em;
}

#season-indicator .dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  transition: background 0.4s ease;
}


/* =============================================================
   8. 底部操作区：进度条 + 留言按钮
   ============================================================= */
#bottom-bar {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  z-index: 100;
  display: flex;
  justify-content: space-between;
  align-items: flex-end;
  padding: 0 28px 20px;
  pointer-events: none;
}

#bottom-bar > * {
  pointer-events: auto;
}

/* 进度条 */
#progress-bar-container {
  flex: 1;
  max-width: 300px;
  margin-right: 20px;
}

#progress-label {
  font-size: 0.7rem;
  color: rgba(240, 230, 211, 0.5);
  letter-spacing: 0.15em;
  margin-bottom: 6px;
}

#progress-bar {
  width: 100%;
  height: 3px;
  background: rgba(255, 255, 255, 0.15);
  border-radius: 2px;
  overflow: hidden;
}

#progress-bar-fill {
  height: 100%;
  background: var(--ms-text-warm);
  border-radius: 2px;
  transition: width 0.2s ease;
}

/* 留言按钮 */
#compose-btn {
  padding: 12px 28px;
  border: 1px solid rgba(240, 230, 211, 0.4);
  border-radius: 999px;
  background: var(--ms-surface-glass);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  color: var(--ms-text-warm);
  font-family: var(--ms-font-body);
  font-size: 0.85rem;
  letter-spacing: 0.15em;
  cursor: pointer;
  transition: all 0.3s ease;
}

#compose-btn:hover {
  background: var(--ms-surface-hover);
  border-color: rgba(240, 230, 211, 0.7);
  transform: translateY(-2px);
}

#compose-btn:disabled {
  opacity: 0.35;
  cursor: not-allowed;
  transform: none;
}


/* =============================================================
   9. 留言弹窗（模态框）
   ============================================================= */
#modal-overlay {
  position: fixed;
  inset: 0;
  z-index: 500;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(10, 10, 20, 0.7);
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.35s ease, visibility 0.35s ease;
}

#modal-overlay.visible {
  opacity: 1;
  visibility: visible;
}

#modal-box {
  width: 90%;
  max-width: 440px;
  background: #1e1e32;
  border: 1px solid var(--ms-border-subtle);
  border-radius: 16px;
  padding: 32px 28px;
  transform: translateY(20px) scale(0.97);
  transition: transform 0.35s ease;
  box-shadow: 0 24px 80px rgba(0, 0, 0, 0.4);
}

#modal-overlay.visible #modal-box {
  transform: translateY(0) scale(1);
}

#modal-box h2 {
  font-family: var(--ms-font-display);
  font-size: 1.3rem;
  color: var(--ms-text-warm);
  letter-spacing: 0.08em;
  margin-bottom: 6px;
}

#modal-box .modal-subtitle {
  font-size: 0.78rem;
  color: var(--ms-text-dim);
  letter-spacing: 0.05em;
  margin-bottom: 24px;
}

#modal-box textarea {
  width: 100%;
  height: 120px;
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid var(--ms-border-subtle);
  border-radius: 10px;
  padding: 14px 16px;
  color: #e0d6c3;
  font-family: var(--ms-font-body);
  font-size: 0.9rem;
  line-height: 1.7;
  resize: none;
  outline: none;
  transition: border-color 0.3s ease;
}

#modal-box textarea:focus {
  border-color: var(--ms-border-hover);
}

#modal-box textarea::placeholder {
  color: var(--ms-text-ghost);
}

/* 字数统计 */
#char-count {
  text-align: right;
  font-size: 0.7rem;
  color: var(--ms-text-faint);
  margin-top: 6px;
}

#char-count.warn {
  color: #e64a19;
}

/* 弹窗按钮组 */
#modal-actions {
  display: flex;
  gap: 12px;
  justify-content: flex-end;
  margin-top: 20px;
}

.modal-btn {
  padding: 10px 24px;
  border-radius: 999px;
  font-family: var(--ms-font-body);
  font-size: 0.82rem;
  letter-spacing: 0.1em;
  cursor: pointer;
  transition: all 0.25s ease;
  border: none;
}

.modal-btn.cancel {
  background: transparent;
  color: var(--ms-text-dim);
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.modal-btn.cancel:hover {
  color: var(--ms-text-warm);
  border-color: rgba(240, 230, 211, 0.3);
}

.modal-btn.submit {
  background: rgba(240, 230, 211, 0.12);
  color: var(--ms-text-warm);
  border: 1px solid rgba(240, 230, 211, 0.3);
}

.modal-btn.submit:hover {
  background: rgba(240, 230, 211, 0.22);
}

.modal-btn.submit:disabled {
  opacity: 0.35;
  cursor: not-allowed;
}

/* 指纹信息 */
#fingerprint-info {
  margin-top: 18px;
  padding: 10px 14px;
  background: rgba(255, 255, 255, 0.03);
  border-radius: 8px;
  font-size: 0.72rem;
  color: var(--ms-text-faint);
  line-height: 1.6;
}

#fingerprint-info code {
  color: var(--ms-text-muted);
  font-family: var(--ms-font-mono);
  font-size: 0.68rem;
}


/* =============================================================
   10. Toast 提示
   ============================================================= */
#toast {
  position: fixed;
  top: 80px;
  left: 50%;
  transform: translateX(-50%) translateY(-20px);
  z-index: 999;
  padding: 12px 24px;
  border-radius: 999px;
  background: rgba(30, 30, 50, 0.9);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(240, 230, 211, 0.2);
  color: var(--ms-text-warm);
  font-size: 0.82rem;
  letter-spacing: 0.05em;
  opacity: 0;
  visibility: hidden;
  transition: all 0.35s ease;
}

#toast.show {
  opacity: 1;
  visibility: visible;
  transform: translateX(-50%) translateY(0);
}


/* =============================================================
   11. 滚动引导
   ============================================================= */
#scroll-hint {
  position: fixed;
  bottom: 100px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 50;
  display: flex;
  align-items: center;
  gap: 8px;
  color: rgba(240, 230, 211, 0.4);
  font-size: 0.78rem;
  letter-spacing: 0.15em;
  animation: hintPulse 2s ease infinite;
  pointer-events: none;
  transition: opacity 0.5s ease;
}

#scroll-hint.hidden {
  opacity: 0;
}

#scroll-hint svg {
  animation: hintSlide 1.5s ease infinite;
}


/* =============================================================
   12. 空状态
   ============================================================= */
#empty-state {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
  color: rgba(240, 230, 211, 0.3);
  z-index: 5;
  pointer-events: none;
}

#empty-state h2 {
  font-family: var(--ms-font-display);
  font-size: 1.6rem;
  letter-spacing: 0.1em;
  margin-bottom: 8px;
}

#empty-state p {
  font-size: 0.85rem;
  letter-spacing: 0.12em;
}


/* =============================================================
   13. 管理工具栏（CSV 导入/导出）
   ============================================================= */
#admin-tools {
  position: fixed;
  top: 16px;
  right: 28px;
  z-index: 100;
  display: flex;
  gap: 8px;
}

.admin-btn {
  padding: 6px 14px;
  border-radius: 6px;
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  color: var(--ms-text-dim);
  font-size: 0.68rem;
  letter-spacing: 0.08em;
  cursor: pointer;
  font-family: var(--ms-font-body);
  transition: all 0.25s ease;
}

.admin-btn:hover {
  color: var(--ms-text-warm);
  border-color: rgba(240, 230, 211, 0.3);
}


/* =============================================================
   14. 关键帧动画
   ============================================================= */
@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(20px); }
  to   { opacity: 1; transform: translateY(0); }
}

@keyframes cardAppear {
  from { opacity: 0; transform: translateY(30px); }
  to   { opacity: 1; transform: translateY(0); }
}

@keyframes hintPulse {
  0%, 100% { opacity: 0.4; }
  50%      { opacity: 0.8; }
}

@keyframes hintSlide {
  0%, 100% { transform: translateX(0); }
  50%      { transform: translateX(8px); }
}


/* =============================================================
   15. 响应式适配
   ============================================================= */
@media (max-width: 600px) {
  .message-card {
    width: 170px;
    padding: 14px 12px;
  }

  .message-card .card-content {
    font-size: 0.8rem;
  }

  #site-title {
    font-size: 1.1rem;
  }

  #compose-btn {
    padding: 10px 20px;
    font-size: 0.78rem;
  }

  #modal-box {
    padding: 24px 20px;
  }

  #admin-tools {
    top: auto;
    bottom: 60px;
    right: 16px;
    flex-direction: column;
  }
}
