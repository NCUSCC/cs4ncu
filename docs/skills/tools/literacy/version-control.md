---
tags:
  - Level-Beginner
  - Topic-Academics
  - Topic-ComputerLiteracy
---

# 项目开发版本控制与依赖管理建议书

## **1. 引言：为什么版本控制如此重要？**

在软件开发，特别是数据科学和深度学习领域，项目成功的高度依赖于其运行环境的稳定性和可复现性。版本选择并非追求“最新”就是最好，而是一项关乎项目稳定、团队协作和开发效率的核心工程实践。

**不注重版本控制可能导致以下严重问题：**

*   **环境冲突与报错：** 这是最常见的问题。库与库之间、库与底层系统（如CUDA）之间存在复杂的依赖关系。随意安装版本极易导致`ImportError`, `AttributeError`, `RuntimeError`等难以排查的错误。
*   **安装失败：** `pip` 或 `conda` 在解析依赖关系时，若无法找到满足所有版本约束的安装组合，便会直接报错退出，导致环境搭建失败。
*   **隐性Bug与不稳定性：** 最新发布的版本（如 `v2.1.0`）可能尚未经过大规模社区测试，存在未知的致命Bug。例如，近期Windows 11的KB5063878更新就疑似出现了下载大规模文件时会出现自动删盘的bug
*   **性能差异与结果无法复现：** 深度学习框架的不同版本可能在底层实现上有优化或改动，导致同一份代码在不同版本上运行速度不同，甚至产生不同的结果，这使得模型训练和实验复现变得不可能。

!!! example " 深度学习领域的“依赖地狱” "
    **PyTorch / TensorFlow 与 CUDA**—— 这是最经典的版本制约链：
    NVIDIA GPU的驱动版本决定了其支持的**最高CUDA版本**（如RTX 3090支持最高CUDA 11.8）。
    PyTorch/TensorFlow的每个发布版本都**仅编译支持特定的CUDA版本**（如PyTorch 1.13需要CUDA 11.7，而PyTorch 2.0需要CUDA 11.8或12.1）。
    若在仅支持CUDA 11.8的机器上错误安装了需要CUDA 12.1的PyTorch，则会报错 `undefined symbol: ` 或直接提示CUDA不可用。

    **PyTorch 与 Python：**
    较新的PyTorch版本（如v2.0+）通常会逐步放弃对老旧Python版本（如Python 3.6）的支持。若系统只有Python 3.6，则无法安装PyTorch 2.0。

    **库与库之间的制约：**
    `torchvision`、`torchaudio` 必须与 `PyTorch` 主版本严格对应。
    `tensorflow-gpu` 2.10是最后一个在原生Windows上支持GPU的版本，2.11及以上版本需要依赖WSL2。
    一些高级库如 `mmdetection` (目标检测库) 或 `transformers` (Hugging Face) 会对PyTorch、Python乃至GCC编译器的版本有明确的要求。

---

## **2. 不同场景下的策略：单独某个工具/库的版本选择**

对于单个库，选择版本的建议是：**选择距离当前最新版本的前1-2个稳定版本。**

*   **为什么不选最新版？**
    最新版（例如刚发布的 `v2.2.0`）虽然功能最前沿，但发布周期短，潜藏的新Bug未被充分发现和修复，贸然使用相当于将自己暴露在风险之中。

*   **为什么不选过旧版本？**
    老旧版本（如两年前的 `v1.5.0`）可能缺乏新功能，不再接收安全更新，并且可能与生态系统中的其他新工具不兼容。

*   **“前1-2个版本”策略的优势：**
    这个版本的策略（例如最新版是 `v2.2.0`，则选择 `v2.1.2` 或 `v2.0.1`）能完美平衡稳定性和功能性。它已经经历了数个月的生产环境考验，大部分严重Bug已被修复，同时又能享受到现代特性和社区支持。

---

## **3. 不同场景下的策略：多库协同的版本控制**

当项目需要多个库协同工作时，依赖关系变得错综复杂。如果没有项目方提供的 `requirements.txt` 或 `environment.yml` 文件，可以遵循以下策略：

**i. 官方文档是黄金标准**
安装任何库之前，第一件事就是访问其官方文档（通常是GitHub README或官方文档网站的Installation/Get Started部分）。文档通常会明确列出其依赖的主要库的版本范围。这是最权威、最准确的来源。

**ii. 善用报错信息，迭代式安装**
这是一种非常实用且高效的方法。
1.  **大胆假设：** 为先为每个库安装一个符合“前1-2个版本”策略的版本。
   
2.  **小心验证：** 运行你的项目核心代码。
   
3.  **仔细报错：** 当出现版本冲突时，错误信息通常会非常明确。例如：
    *   `ImportError: cannot import name 'xxx' from 'yyy'`：可能是由于版本过新，API已变更。   

    *   `AssertionError: Torch not compiled with CUDA enabled`：PyTorch版本与CUDA版本不匹配。

    *   `The requested version of tensorflow (2.12) is not compatible with the current version of keras (2.9). Please install keras 2.12.`：错误信息直接告诉了你需要的版本！
4.  **求助AI：** 将完整的报错信息复制到ChatGPT或Copilot等AI编程助手中，它们通常能精准地识别出这是版本冲突问题，并直接给出安装正确版本的命令

!!! note " 记笔记 "
    通过“安装 -> 运行 -> 报错 -> 修正”的快速迭代，可以逐步将环境稳定下来。

---

## **4. 核心最佳实践：环境隔离**

不同的项目必然会有不同的版本需求。因此，**绝对禁止在操作系统的基础Python环境中安装所有库**。必须为每个项目创建独立的虚拟环境。

推荐工具：

*  **Conda/Miniconda:** 数据科学领域的首选。它不仅管理Python包，还能管理非Python的二进制依赖（如CUDA工具链），功能非常强大。`conda create -n my_project python=3.9`。  

*  **UV:** 一款用Rust编写的极其快速的Python包安装器和解析器，兼容`pip`和`pip-tools`，速度远超传统工具。`uv venv` 即可创建虚拟环境。  

*  **Virtualenv:** Python官方的轻量级虚拟环境管理工具，通常与 `pip` 结合使用。

**工作流：一个项目，一个虚拟环境，一份依赖列表。**
环境搭建完成后，使用 `pip freeze > requirements.txt` 或 `conda env export > environment.yml` 将当前环境的精确版本导出成文件，并随项目代码一同保存。这样，任何协作者都可以一键复现完全相同的环境。

---

## **5. 题外话：关于Windows自动更新**

**为什么要谨慎对待Windows自动更新？**
虽然更新旨在提供安全补丁和新功能，但它也引入了不可预知的风险，尤其是对需要稳定开发环境的专业人士而言。

*  **系统不稳定：** 更新可能引入新的驱动程序或系统组件，与现有的开发环境（如GPU驱动、WSL）产生冲突，导致环境崩溃。如前文提到的Win11更新导致文件系统异常的Bug。

*  **中断工作流：** 更新通常在关键时刻（如模型训练到一半）要求重启，强行打断工作。

*  **依赖关系破坏：** 某些更新可能会更改系统级的库或设置，进而影响安装在系统层面的开发工具（如Python、CUDA）的稳定性。

!!! question " 如何管理Windows更新？ "
  
    修改更新日期教程
    
    （WIN➕R）↓
    
    运行窗口输入：regedit
    
    搜索：计算机\HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\WindowsUpdate\UX\Settings
    
    到达settings目录后在空白处新建DWORD
    
    重命名：FlightSettingsMaxPauseDays
    
    双击打开后选择十进制，数值可以用10000（差不多能延期到52年）
    
    最后再回到系统更新界面选择暂停更新即可



---

!!! author " 总结 "

版本控制是现代软件工程的基石。遵循“选择稍旧的稳定版本”、“善用文档和报错”、“严格进行环境隔离”这三条原则，可以极大地减少环境搭建过程中浪费的时间，提升开发效率和项目稳定性。请将这些实践作为每个项目的标准流程。